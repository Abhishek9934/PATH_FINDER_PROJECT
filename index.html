<!DOCTYPE html>
<html>
<head>
  <title> Path Finder Project</title>

<style type="text/css">


  table, th, td {

  border: 1px solid grey;
  border-collapse: collapse;
}

td {
 width: 30px;
 height: 30px;
}

.visited{

    background-color: blue;

}

.notvisited{
   background-color: #e8e6e8;
}

.wall{
  background-color: #12232e;
}

.startnode{
  background-color: #a31d70;
}

.endnode{
  background-color: #96091e;

}
.pathnode{
  background-color: red;
}


body {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

</style>
 <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>
<body class="container-fluid">

<header class="container-fluid">
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
   

<div class="btn-group">
  <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Choose Algorithm
  </button>
  <div class="dropdown-menu">
    <a class="dropdown-item" href="#">Dijkstra</a>
    <a class="dropdown-item" href="#">A* Search</a>
    <a class="dropdown-item" href="#">Breadth First Search</a>
  </div>
</div>

<!-- 
<button type="button" class="btn btn-outline-warning" style="margin-left: 10px">Clear Path</button>
<button type="button" style="margin-left: 10px" class="btn btn-outline-success" onclick="clearwall()">Clear Walls</button> -->
<button type="button" style="margin-left: 10px" onclick="bfs()" class="btn btn-outline-warning">Visualise Algorithm <span></span></button>

<div class="wall" style="width:25px; height: 25px;   border: 1px solid white;margin-left: 25px;
"></div> <label class="" style="color: white ;margin-left: 10px; margin-top: 10px;">Walls Node</label>



<div  class="pathnode" style="width:25px; height: 25px;  border: 1px solid white; margin-left: 25px;
"></div> 
<label class="" style="color: white ;margin-left: 10px; margin-top: 10px; "> Path Node</label>


<div class="visited pull-right"  style="width:25px; height: 25px;    border: 1px solid white;margin-left: 25px;
"></div>
<label class="" style="color: white ;margin-left: 10px; margin-top: 10px;"> Visited Node</label>



<div class="notvisited pull-right"  style="width:25px; height: 25px;    border: 1px solid white;margin-left: 25px;
"></div>
<label class="" style="color: white ;margin-left: 10px; margin-top: 10px;"> Unvisited Node</label>


<div class="startnode pull-right"  style="width:25px; height: 25px;    border: 1px solid white;margin-left: 25px;
"></div>
<label class="" style="color: white ;margin-left: 10px; margin-top: 10px;"> Start Node</label>


<div class="endnode pull-right"  style="width:25px; height: 25px;    border: 1px solid white;margin-left: 25px;
"></div>
<label class="" style="color: white ;margin-left: 10px; margin-top: 10px;"> Destination Node</label>



</nav>

</header>


<br>
<br>
<div class="container-fluid">

<table class="grid" draggable="false" id = "myGrid" >


</table>
</div>
<script >
 

  var parent=new Map();
  var m = 28;
  var n= 60;
 var rs = m/2 -1;
  var cs = n/3-5 ;
 var ce = 2*n/3 +5;
 
for (var i = 0; i < m; i++){
  
  tr = '<tr id="row'+i.toString()+'">'
  document.getElementById("myGrid").innerHTML += tr;
  ID = 'row'+i.toString();


  for (var j = 0;j< n ;j++){
       
       td =  '<td id="col'+ j.toString() +'" class="notvisited"  onclick="mouseclick(this)" onmouseup="mouseup(this)"  onmousedown="mousedown(this)"  onmouseover="changeColor(this)"   >   </td>'

       tdstart = '<td id="col'+ j.toString() +'" class="startnode"   onmousedown="mousedown(this)"  onmouseover="changeColor(this)" onmouseup="mouseup(this)"   >   </td>'

       tdend = '<td id="col'+ j.toString() +'" class="endnode" onmouseup="mouseup(this)"  onmousedown="mousedown(this)"  onmouseover="changeColor(this)"   >   </td>'

        if(i== rs && j== cs)
        {
          document.getElementById(ID).innerHTML  += tdstart;
          continue;
        }

        if(i== rs  && j== ce)
        {

          document.getElementById(ID).innerHTML  += tdend;

          continue;

        }

         document.getElementById(ID).innerHTML  += td;


     
    }
}


var mouseIsDown = false;
var mouseIsUp = true;
var f=0, g=0;
function mouseclick(grid){

  if ( grid.classList.contains('notvisited') ){
grid.classList.remove('notvisited');

 grid.classList.toggle('wall');
}


else if ( grid.classList.contains('wall') )
{
  grid.classList.remove('wall');
  grid.classList.toggle('notvisited');
}

}

function mousedown(grid){
  
    if ( grid.classList.contains('startnode') ){
        f=1;
        grid.classList.remove('startnode');
        grid.classList.toggle('notvisited');

    }

  else  if ( grid.classList.contains('endnode') )
  {
        g=1;
        grid.classList.remove('endnode');
        grid.classList.toggle('notvisited');

    }

 else{
  mouseIsDown= true;
  mouseIsUp = false;
  }
}

function mouseup(grid)
{
  
  if(f==1 )
  {
    if(!grid.classList.contains('endnode'))
      {
         f=0;
        grid.classList.remove('notvisited');
        grid.classList.toggle('startnode');
      }
   
  }


  if(g==1 )
  {
       
        if(!grid.classList.contains('startnode'))
        {grid.classList.remove('notvisited');
        grid.classList.toggle('endnode');  g=0;
    }
  }

  mouseIsDown= false;
  mouseIsUp= true;

}

function changeColor(grid){


if(mouseIsDown){


if ( grid.classList.contains('notvisited') ){
grid.classList.remove('notvisited');
grid.classList.toggle('wall');
}

else if ( grid.classList.contains('wall') ){
grid.classList.remove('wall');
grid.classList.toggle('notvisited');
}
     

  }
}


// function clearwall(){

// var x=document.querySelector('.wall').id
// // console.log(x);
// var i;
// for (i = 0; i < x.length; i++) {

//   if ( x[i].classList.contains('wall') ){

//   x[i].classList.remove('wall');
//   x[i].classList.add('notvisited');
// }

// }


// }

var matrix = [];
var start =[];
var dest = [];
var parent =[];
// get the matrix 
var flag=0;

function getGrid()
{
  flag=0;
  for (var i=0 ;i< m;i++)
  {
    matrix[i] = new Array();
    for (var j=0;j< n;j++)
    {
      var id = '#row'+i.toString()+' #col'+j.toString();
       cell = document.querySelector(id);
       
       if(cell.classList.contains('wall'))
       {

            matrix[i].push(1);
       } 
       else if (cell.classList.contains('notvisited')) 
       {     
            matrix[i].push(0);
       }
       else if (cell.classList.contains('startnode'))
       {
            matrix[i].push('s');
            start = [i,j];
       } 

       else if (cell.classList.contains('endnode'))
       {
           matrix[i].push('d');
           dest = [i,j];
       }

    }


  }

// console.log(matrix);

}



function isValid(x,y){

  if(x>=0 && x< m && y>=0 && y< n){
     return 1;
  }

  return 0;
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}


 async function bfs(flag)
{
  
  console.log(flag);
  console.log("bfs");
  if(flag==1)
    return;
  else flag=1;
  
    getGrid();
    var parent=new Map();
    var dx=[1,-1,0,0];
    var dy=[0,0,-1,1];
    
    parent=new Map();
  
// Queue class 

    var queue = [];
      parent.clear();
      
    queue.push(start);
    parent.set(start, start);

    var flag=0;
    while(queue.length!=0 )
    {
      
      
     
     var  a= queue[0];

      
      
      queue.shift();
      var xcord = a[0];
      var ycord = a[1];
      
      for (var i=0;i<4;i++)
      {

   
        var x = xcord  + dx[i];
        var y = ycord + dy[i];

        if (isValid(x,y))
        {
          if(matrix[x][y]==2 || matrix[x][y]==1)
          {
            continue;
          }

          var b=[x,y];
          
          parent.set(b,a);
          
          
            
          var id = '#row'+x.toString()+' #col'+y.toString();
          cell = document.querySelector(id);
          
            cell.classList.remove('notvisited');
            cell.classList.toggle('visited');
            matrix[x][y]=2;
            await sleep(5);
           
            
           if(b[0]==dest[0] && b[1]==dest[1])
           {  

                while(1)
                {
                  var a= parent.get(b);
                  if(a[0]==b[0]&& a[1]==b[1])
                  {
                    flag=0;
                    
                    return;
                  }

                  b=a;
                  var id = '#row'+b[0].toString()+' #col'+b[1].toString();
                  cell = document.querySelector(id);
           // if(cell.classList.contains('notvisited')){
                  cell.classList.remove('visited');
                  cell.classList.toggle('notvisited');
                  
                  
                }
            
            
           }
            queue.push(b);
        }
        
      }

    }
    flag=0;
    window.alert("Path is not possible, please remove some walls!!!");
    
 }



</script>




<div id="myModal"  class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Instructions</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
      <ul>
        
        <li>Click within the grid and drag the mouse to draw walls.</li>
        <li>Drag the start and end node to any position.</li>
        <li> Choose an algorithm from the navigation panel.</li>
        <li>Click the Visulaise algorithm button to see the algorithms in action.</li>
      </ul>
      </div>
      
    </div>
  </div>
</div>


<script type="text/javascript">
  $('#myModal').modal('show')

</script>
</body>

</html>